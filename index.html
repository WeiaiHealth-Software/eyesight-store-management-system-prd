<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>惟翎 · 眼视光门店管理系统</title>
    <link rel="icon" href="logo.svg" type="image/svg+xml">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                    colors: {
                        primary: {
                            50: '#f0fdf4',
                            100: '#dcfce7',
                            200: '#86efac',
                            300: '#4ade80',
                            400: '#22c55e',
                            500: '#15803d',
                            600: '#166534',
                            700: '#14532d',
                            800: '#14532d',
                            900: '#052e16',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body { background-color: #f3f4f6; } 
        .card-shadow { box-shadow: 0 4px 20px -2px rgba(0, 0, 0, 0.05); }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        
        /* 导航样式 */
        .nav-active { background-color: #151515; color: white; } 
        .nav-inactive { color: #353535; background-color: transparent; }
        .nav-inactive:hover { background-color: rgba(255,255,255,0.8); color: #151515; }
        
        /* 二级菜单 Pill 样式 */
        .sub-nav-active { background-color: #f0fdf4; color: #15803d; font-weight: 600; border: 1px solid #dcfce7; }
        .sub-nav-inactive { color: #4b5563; font-weight: 500; border: 1px solid transparent; }
        .sub-nav-inactive:hover { background-color: #f9fafb; color: #374151; }
    </style>
</head>
<body class="text-gray-800 font-sans antialiased h-screen flex flex-col overflow-hidden bg-[#f3f4f6]">

    <!-- === Level 1: 顶部主导航 (透明背景) === -->
    <nav class="w-full flex-none py-4 px-6 lg:px-8 z-50">
        <div class="mx-auto flex justify-between items-center h-14">
            <div class="flex items-center gap-10">
                <!-- Logo -->
                <div class="flex-shrink-0 flex items-center gap-2 cursor-pointer">
                  <img src="logo.svg" alt="logo" class="w-12 h-12">
                  <span class="hidden min-[1400px]:block font-bold text-3xl tracking-tight text-gray-900">眼视光门店管理系统</span>
                </div>
            </div>

            <!-- 一级菜单容器 (磨砂效果) -->
            <div id="level1-menu" class="hidden md:flex bg-white/80 backdrop-blur-md p-2 rounded-full border border-white/40 shadow-sm">
                <!-- JS 渲染 -->
            </div>

            <!-- 右侧用户区 -->
            <div class="flex items-center gap-2">
                <button class="w-12 h-12 rounded-full bg-white hover:bg-gray-50 flex items-center justify-center text-gray-500 shadow-sm relative transition">
                    <i class="ph-bold ph-bell text-2xl"></i>
                    <span class="absolute top-2 right-2.5 w-3 h-3 bg-red-500 rounded-full border-2 border-white"></span>
                </button>
                <!-- System Settings Button -->
                <button onclick="toggleSettingsDrawer()" class="w-12 h-12 rounded-full bg-white hover:bg-gray-50 flex items-center justify-center text-gray-500 shadow-sm transition ml-2" title="系统设置">
                    <i class="ph-bold ph-gear text-2xl"></i>
                </button>
                <div class="flex items-center gap-3 pl-4 border-l border-gray-300/50">
                    <div class="text-right hidden lg:block leading-tight">
                        <p class="font-bold text-sm text-gray-900">张店长</p>
                        <p class="text-gray-500 text-xs">北京旗舰店</p>
                    </div>
                    <img class="h-9 w-9 rounded-full object-cover border-2 border-white shadow-sm" src="https://images.unsplash.com/photo-1535713875002-d1d0cf377fde?ixlib=rb-1.2.1&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80">
                </div>
            </div>
        </div>
    </nav>

    <!-- === Level 2: 二级功能导航栏 (卡片式悬浮) === -->
    <!-- 关键修改：增加了 px-6 lg:px-8 让其有边距，内部是 max-w-[1800px] -->
    <div class="w-full flex-none px-6 lg:px-8 mt-2 z-40">
        <div class="mx-auto bg-white rounded-2xl shadow-sm border border-gray-200 h-20 flex items-center justify-between px-6 lg:px-8">
            <!-- 左侧：大标题 + 竖线 + Pill 菜单 -->
            <div class="flex items-center gap-8 h-full">
                <!-- 标题放大 -->
                <h2 id="page-title" class="text-2xl font-bold text-gray-900 tracking-tight">仪表盘</h2>
                
                <div class="h-8 w-px bg-gray-200"></div> <!-- 分割线 -->
                
                <div id="level2-menu" class="flex items-center gap-2">
                    <!-- JS 渲染二级菜单 -->
                </div>
            </div>

            <!-- 右侧：页面级筛选器 -->
            <div class="flex items-center gap-3">
                <div class="relative group">
                    <button class="flex items-center gap-2 text-sm font-medium text-gray-600 bg-gray-50 hover:bg-gray-100 px-3 py-2 rounded-lg border border-gray-200 transition">
                        <i class="ph-bold ph-calendar-blank"></i>
                        <span>本月 (2024-05)</span>
                        <i class="ph-bold ph-caret-down text-xs"></i>
                    </button>
                </div>
                <div class="relative">
                    <button class="flex items-center gap-2 text-sm font-medium text-gray-600 bg-gray-50 hover:bg-gray-100 px-3 py-2 rounded-lg border border-gray-200 transition">
                        <i class="ph-bold ph-storefront"></i>
                        <span>全部门店</span>
                        <i class="ph-bold ph-caret-down text-xs"></i>
                    </button>
                </div>
                <button class="p-2 text-gray-400 hover:text-primary-600 transition">
                    <i class="ph-bold ph-export text-xl"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- === Main Content: 内容区域 === -->
    <!-- 增加 pt-6 让内容与上方卡片保持间距 -->
    <main id="main-content" class="flex-1 w-full overflow-y-auto no-scrollbar px-6 py-4 lg:px-8 py-6">
        <!-- <div class="max-w-[1800px] mx-auto h-full"> -->
        <div class="mx-auto h-full">
            <!-- 场景 1: 仪表盘-店长视图 -->
            <div id="dashboard-view" class="h-full flex flex-col">
                <!-- KPI 卡片 -->
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6 flex-none">
                    <div class="bg-primary-500 rounded-2xl p-4 lg:p-6 2xl:p-8 relative overflow-hidden card-shadow flex flex-col justify-between group transition hover:translate-y-[-2px]">
                        <div class="flex justify-between items-start mb-6 lg:mb-8 2xl:mb-10 relative z-10">
                            <div class="flex items-center justify-center">
                              <p class="text-2xl text-white font-bold">营收</p>
                            </div>
                            <div class="bg-white/20 text-white text-md font-bold px-2 py-1 rounded-md flex items-center gap-1">
                                <i class="ph-bold ph-arrow-up-right"></i> +17%
                            </div>
                        </div>
                        <div>
                            <p class="text-4xl font-bold text-white tracking-tight">¥ 12,087</p>
                        </div>
                    </div>
                    <div class="bg-white rounded-2xl p-4 lg:p-6 2xl:p-8 card-shadow flex flex-col justify-between transition hover:translate-y-[-2px]">
                        <div class="flex justify-between items-start mb-6 lg:mb-8 2xl:mb-10 relative z-10">
                            <div class="flex items-center justify-center text-gray-900">
                              <p class="text-2xl text-gray-900 font-bold">本月预约量</p>
                            </div>
                            <div class="text-red-600 bg-red-50 text-md font-bold px-2 py-1 rounded-md">
                              <i class="ph-bold ph-arrow-down-right"></i> -12%
                            </div>
                        </div>
                        <div> 
                          <p class="text-4xl font-bold text-gray-900 tracking-tight">892 <span class="text-sm font-normal text-gray-400">人次</span></p>
                        </div>
                    </div>
                    <div class="bg-white rounded-2xl p-4 lg:p-6 2xl:p-8 card-shadow flex flex-col justify-between transition hover:translate-y-[-2px]">
                        <div class="flex justify-between items-center mb-4 lg:mb-6 2xl:mb-8 relative z-10">
                            <p class="text-2xl text-gray-900 font-bold">销售目标</p>
                            <i class="ph-bold ph-dots-three text-gray-400"></i>
                        </div>
                        <div>
                            <p class="text-3xl font-bold text-gray-900 mb-4 lg:mb-6 2xl:mb-8 tracking-tight">¥ 50,901 <span class="text-sm text-gray-400 font-normal">/ ¥68k</span></p>
                            <div class="w-full bg-gray-100 rounded-full h-3 overflow-hidden">
                                <div class="bg-primary-500 h-full rounded-full" style="width: 75%"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 图表区域 -->
                <div class="flex-1 grid grid-cols-1 lg:grid-cols-3 gap-6 min-h-0">
                    <div class="bg-white rounded-2xl p-6 card-shadow flex flex-col justify-between h-full">
                        <div>
                            <div class="flex justify-between items-start">
                                <div>
                                    <h3 class="text-gray-900 font-bold text-2xl">客户满意度</h3>
                                    <p class="text-gray-400 text-md mt-1">最高正面反馈</p>
                                </div>
                                <button class="text-gray-400 hover:text-gray-600"><i class="ph-bold ph-dots-three text-xl"></i></button>
                            </div>
                        </div>

                        <div class="flex-1 relative flex items-center justify-center my-2">
                            <div class="w-48 h-40 lg:w-64 lg:h-48 xl:w-80 xl:h-64 relative flex items-center justify-center">
                                <canvas id="satisfactionChart"></canvas>
                                <div class="absolute inset-0 flex flex-col items-center justify-center pt-4 pointer-events-none">
                                    <p class="text-3xl font-bold text-gray-900 tracking-tight">250</p>
                                    <p class="text-gray-400 text-xs mt-1">本月答复</p>
                                </div>
                            </div>
                        </div>

                        <!-- Legend -->
                        <div class="flex justify-center gap-4 mb-6">
                            <div class="flex items-center gap-1.5">
                                <span class="w-4 h-4 rounded-full bg-[#15803d]"></span>
                                <span class="text-md font-bold text-gray-600">满意</span>
                            </div>
                            <div class="flex items-center gap-1.5">
                                <span class="w-4 h-4 rounded-full bg-[#86efac]"></span>
                                <span class="text-md font-bold text-gray-600">中规中矩</span>
                            </div>
                            <div class="flex items-center gap-1.5">
                                <span class="w-4 h-4 rounded-full bg-gray-200"></span>
                                <span class="text-md font-bold text-gray-600">不满意</span>
                            </div>
                        </div>

                        <!-- Stats & Description -->
                        <div class="flex flex-col gap-3">
                            <div class="flex items-center gap-3 bg-gray-50 rounded-full p-1 pr-4 w-full">
                                <div class="bg-[#dcfce7] text-[#166534] text-xs font-bold px-3 py-2 rounded-full flex items-center gap-1 whitespace-nowrap">
                                    <i class="ph-bold ph-arrow-up-right"></i> +12%
                                </div>
                                <span class="text-md text-gray-500 font-medium truncate">客户满意度 (CSAT): 4.7/5</span>
                            </div>
                            <p class="text-center text-lg font-bold text-gray-900">卓越的支持和快速的响应</p>
                        </div>
                    </div>
                    <div class="bg-white rounded-2xl p-7 card-shadow lg:col-span-2 flex flex-col">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-gray-900 font-bold text-2xl">营收趋势分析</h3>
                            <div class="flex bg-gray-100 p-0.5 rounded-lg">
                                <button class="px-3 py-1 bg-white shadow-sm rounded-md text-xs font-bold text-gray-900">月视图</button>
                                <button class="px-3 py-1 text-xs text-gray-500">年视图</button>
                            </div>
                        </div>
                        <div class="flex-1 relative w-full">
                            <canvas id="revenueChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 场景 2: 通用功能占位符 -->
            <div id="generic-view" class="hidden h-full flex flex-col items-center justify-center text-center">
                <div class="w-24 h-24 bg-white shadow-sm border border-gray-100 rounded-2xl flex items-center justify-center mb-6">
                    <i id="generic-icon" class="ph-duotone ph-wrench text-5xl text-primary-500"></i>
                </div>
                <h2 id="generic-title" class="text-3xl font-bold text-gray-900 mb-2">页面标题</h2>
                <p class="text-gray-500 max-w-md mb-8 text-sm">此模块的二级页面已构建完毕，等待填充具体业务组件。</p>
                
                <div class="bg-white rounded-2xl shadow-sm border border-gray-200 p-8 max-w-3xl w-full text-left relative overflow-hidden">
                    <div class="absolute top-0 left-0 w-1 h-full bg-primary-500"></div>
                    <h3 class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-6 flex items-center gap-2">
                        <i class="ph-bold ph-list-dashes"></i> 本页面包含功能模块
                    </h3>
                    <div id="feature-list" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- JS 填充 -->
                    </div>
                </div>
            </div>

        </div>
    </main>

    <!-- System Settings Drawer -->
    <div id="settings-drawer-overlay" onclick="toggleSettingsDrawer()" class="fixed inset-0 bg-black/20 z-[60] hidden transition-opacity duration-300 opacity-0 backdrop-blur-sm"></div>
    <div id="settings-drawer" class="fixed top-0 right-0 h-full w-96 bg-white shadow-2xl z-[70] transform translate-x-full transition-transform duration-300 flex flex-col">
        <div class="p-6 border-b border-gray-100 flex justify-between items-center bg-gray-50/50">
            <h2 class="text-xl font-bold text-gray-900 flex items-center gap-2"><i class="ph-duotone ph-gear text-primary-600"></i> 系统设置</h2>
            <button onclick="toggleSettingsDrawer()" class="w-8 h-8 rounded-full hover:bg-gray-100 flex items-center justify-center text-gray-400 hover:text-gray-600 transition">
                <i class="ph-bold ph-x text-lg"></i>
            </button>
        </div>
        <div class="p-6 overflow-y-auto flex-1 bg-white">
             <!-- Card to link to screen-list.html -->
             <a href="screen-list.html" target="_blank" class="block bg-white rounded-2xl border border-gray-100 p-5 shadow-sm hover:shadow-md hover:border-primary-200 transition group relative overflow-hidden">
                <div class="absolute top-0 right-0 p-3 opacity-10 group-hover:opacity-20 transition">
                    <i class="ph-duotone ph-television text-6xl text-primary-500"></i>
                </div>
                <div class="flex items-start gap-4 mb-3 relative z-10">
                    <div class="w-12 h-12 bg-primary-50 text-primary-600 rounded-xl flex items-center justify-center flex-none">
                        <i class="ph-duotone ph-television text-2xl"></i>
                    </div>
                    <div>
                        <h3 class="font-bold text-gray-900 text-lg group-hover:text-primary-600 transition">诊室列表大屏</h3>
                        <p class="text-xs text-gray-500 mt-1">大厅/走廊综合显示屏</p>
                    </div>
                </div>
                <p class="text-sm text-gray-500 relative z-10 leading-relaxed">点击查看所有诊室的实时排队叫号状态，支持大屏展示模式。</p>
                <div class="mt-4 flex items-center text-primary-600 text-sm font-bold opacity-0 group-hover:opacity-100 transition transform translate-x-[-10px] group-hover:translate-x-0">
                    打开大屏 <i class="ph-bold ph-arrow-right ml-1"></i>
                </div>
             </a>
             
             <!-- Placeholder for future settings -->
             <div class="mt-8">
                <h3 class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-4">更多设置</h3>
                <div class="space-y-3">
                    <div class="flex items-center justify-between p-4 bg-gray-50 rounded-xl border border-gray-100 opacity-50 cursor-not-allowed">
                        <div class="flex items-center gap-3">
                            <i class="ph-duotone ph-paint-bucket text-gray-400 text-xl"></i>
                            <span class="text-gray-500 font-medium">主题外观</span>
                        </div>
                        <i class="ph-bold ph-lock-key text-gray-300"></i>
                    </div>
                    <div class="flex items-center justify-between p-4 bg-gray-50 rounded-xl border border-gray-100 opacity-50 cursor-not-allowed">
                        <div class="flex items-center gap-3">
                            <i class="ph-duotone ph-users-three text-gray-400 text-xl"></i>
                            <span class="text-gray-500 font-medium">账号权限</span>
                        </div>
                        <i class="ph-bold ph-lock-key text-gray-300"></i>
                    </div>
                </div>
             </div>
        </div>
        <div class="p-4 border-t border-gray-100 bg-gray-50 text-center text-xs text-gray-400">
            EyeSight Management System v1.0.0
        </div>
    </div>

    <script>
        function toggleSettingsDrawer() {
            const drawer = document.getElementById('settings-drawer');
            const overlay = document.getElementById('settings-drawer-overlay');
            
            if (drawer.classList.contains('translate-x-full')) {
                // Open
                overlay.classList.remove('hidden');
                // small delay to allow display:block to apply before opacity transition
                setTimeout(() => {
                    overlay.classList.remove('opacity-0');
                    drawer.classList.remove('translate-x-full');
                }, 10);
            } else {
                // Close
                drawer.classList.add('translate-x-full');
                overlay.classList.add('opacity-0');
                setTimeout(() => {
                    overlay.classList.add('hidden');
                }, 300);
            }
        }

        const menuConfig = {
            dashboard: {
                id: 'dashboard', icon: 'ph-squares-four', label: '仪表盘',
                subs: [
                    { id: 'store_view', label: '门店经营概览', features: [] },
                    { id: 'doctor_view', label: '医生个人看板', features: ['我的今日排班', '个人业绩进度条', '今日预约患者列表', '待复查患者提醒'] },
                    { id: 'front_view', label: '前台工作台', features: ['今日预约看板', '现场快速登记', '待服务队列', '爽约记录处理'] }
                ]
            },
            analytics: {
                id: 'analytics', icon: 'ph-chart-bar', label: '数据分析',
                subs: [
                    { id: 'financial', label: '财务报表', features: ['营收统计 (日/月/年)', '支付方式构成分析', '欠款/挂账统计', '退款率分析'] },
                    { id: 'sales', label: '销售分析（原CRM消费统计）', features: ['套餐销量排行榜', '镜片/镜架 SKU 动销率', '全局消费统计', '周期/类目统计'] },
                    { id: 'traffic', label: '客流分析', features: ['新老客占比趋势', '渠道来源分析 (小程序/自然)', '到店转化漏斗', '客流高峰时段热力图'] },
                    { id: 'quality', label: '医疗质量', features: ['验光处方修改率', '复查异常率统计', '加工损耗率', '客户投诉/满意度分析'] },
                ]
            },
            crm: {
                id: 'crm', icon: 'ph-users', label: '客户档案(CRM)',
                subs: [
                    { id: 'client_list', label: '客户列表', features: ['全量客户查询', '高级筛选 (年龄/度数/来源)', '客户画像 360视图', '导出 Excel'] },
                    { id: 'consumer', label: '消费管理', features: ['消费记录列表（高级筛选）', '新增销售开单', '收费项目列表', '新增收费项目'] },
										{ id: 'booking', label: '预约管理', features: ['日历视图排班', '预约创建与修改', '医生/设备资源占用', '预约短信通知'] },
                    { id: 'followup', label: '回访管理', features: ['新增回访记录', '筛选条件（姓名、电话、日期、回访项目类型）', '复诊回访列表', '回访统计、复查完成率统计'] },
										{ id: 'optometry', label: '验光记录', features: ['验光单据查询', '历史光度趋势对比', '处方打印', '视觉训练记录'] },
                    { id: 'member', label: '会员管理', features: ['会员等级规则配置', '积分兑换记录', '会员专属权益设置', '家庭档案绑定'] },
                ]
            },
            store_mgmt: {
                id: 'store_mgmt', icon: 'ph-storefront', label: '门店管理',
                subs: [
                    { id: 'doctor_mgmt', label: '医生管理', features: ['医生档案维护 (职称/专业)', '医生账号权限设置', '业绩指标设定', '医生个人简介配置'] },
                    { id: 'room_mgmt', label: '诊室管理', features: ['诊室编号/名称设置', '诊室设备绑定 (综合验光仪等)', '诊室状态监控', '数字标牌设备绑定'] },
                    { id: 'scheduling', label: '医生排班', features: ['可视化排班表 (日/周/月)', '排班关联诊室 (自动分配)', '临时调班/请假处理', '排班发布与通知'] }
                ]
            },
            inventory: {
                id: 'inventory', icon: 'ph-package', label: '库存管理(ERP)',
                subs: [
                    { id: 'product', label: '商品管理', features: ['全量商品库查询', '商品档案列表', '实时库存详情', '价格体系维护'] },
                    { id: 'inbound', label: '入库管理', features: ['采购订单创建', '采购入库单', '销售退回入库', '供应商管理'] },
                    { id: 'outbound', label: '出库管理', features: ['销售出库记录', '采购退货出库', '报损/领用出库', '出库单据管理'] },
                    { id: 'category', label: '类目管理', features: ['商品类目树维护', '新增/编辑类目', '类目属性模板配置', '类目关联品牌设置'] },
                    { id: 'transfer', label: '盘点调拨', features: ['门店间调货申请', '月度/季度盘点录入', '盘盈盘亏调整', '库存流水日志'] }
                ]
            },
            pos: {
                id: 'pos', icon: 'ph-receipt', label: '单据收银',
                subs: [
                    { id: 'cashier', label: '收银台', features: ['快速开单 (选人->选品)', '验光数据关联', '套餐/折扣应用', '聚合支付结算'] },
                    { id: 'orders', label: '消费记录', features: ['历史订单查询', '退款/冲红操作', '补打小票', '电子发票开具'] },
                ]
            }
        };

        let currentL1 = 'dashboard';
        let currentL2 = 'store_view';

        function renderApp() { renderLevel1(); renderLevel2(); renderContent(); }

        function renderLevel1() {
            document.getElementById('level1-menu').innerHTML = Object.values(menuConfig).map(item => `
                <button onclick="switchLevel1('${item.id}')" 
                    class="px-5 py-2 rounded-full text-lg font-medium flex items-center gap-2 transition 
                    ${currentL1 === item.id ? 'nav-active shadow-md' : 'nav-inactive'}">
                    <i class="ph-bold ${item.icon}"></i> ${item.label}
                </button>
            `).join('');
        }

        function renderLevel2() {
            const config = menuConfig[currentL1];
            document.getElementById('page-title').innerText = config.label;
            document.getElementById('level2-menu').innerHTML = config.subs.map(sub => `
                <button onclick="switchLevel2('${sub.id}')"
                    class="px-5 py-2 rounded-lg text-md transition cursor-pointer whitespace-nowrap
                    ${currentL2 === sub.id ? 'sub-nav-active' : 'sub-nav-inactive'}">
                    ${sub.label}
                </button>
            `).join('');
        }

        function renderContent() {
            const dashboardEl = document.getElementById('dashboard-view');
            const genericEl = document.getElementById('generic-view');
            const sub = menuConfig[currentL1].subs.find(s => s.id === currentL2);

            if (currentL1 === 'dashboard' && currentL2 === 'store_view') {
                dashboardEl.classList.remove('hidden');
                genericEl.classList.add('hidden');
                initCharts();
            } else {
                dashboardEl.classList.add('hidden');
                genericEl.classList.remove('hidden');
                document.getElementById('generic-title').innerText = sub.label;
                document.getElementById('generic-icon').className = `ph-duotone ${getIconForSection(currentL1)} text-5xl text-primary-500`;
                document.getElementById('feature-list').innerHTML = (sub.features || []).map(f => `
                    <div class="flex items-center gap-3 p-4 bg-gray-50 rounded-xl border border-gray-100 hover:border-primary-200 transition group">
                        <div class="w-8 h-8 rounded-full bg-white flex items-center justify-center border border-gray-100 text-primary-500 group-hover:bg-primary-50 group-hover:scale-110 transition">
                            <i class="ph-bold ph-check"></i>
                        </div>
                        <span class="text-sm text-gray-700 font-medium group-hover:text-gray-900">${f}</span>
                    </div>
                `).join('');
            }
        }

        function getIconForSection(id) {
            const map = { dashboard: 'ph-squares-four', analytics: 'ph-chart-bar', crm: 'ph-users', store_mgmt: 'ph-storefront', inventory: 'ph-package', pos: 'ph-receipt' };
            return map[id] || 'ph-circles-four';
        }

        window.switchLevel1 = (id) => { currentL1 = id; currentL2 = menuConfig[id].subs[0].id; renderApp(); };
        window.switchLevel2 = (id) => { currentL2 = id; renderLevel2(); renderContent(); };

        let charts = {};
        function initCharts() {
            if (charts.bar) charts.bar.destroy();
            if (charts.doughnut) charts.doughnut.destroy();

            const ctxBar = document.getElementById('revenueChart').getContext('2d');
            const gradient = ctxBar.createLinearGradient(0, 0, 0, 300);
            gradient.addColorStop(0, '#15803d'); gradient.addColorStop(1, '#d9f99d');

            charts.bar = new Chart(ctxBar, {
                type: 'bar',
                data: {
                    labels: ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12'],
                    datasets: [
                        { label: '配镜', data: [35, 42, 30, 45, 58, 72, 65, 48, 40, 55, 62, 80], backgroundColor: '#15803d', borderRadius: 4, barThickness: 24 },
                        { label: '验光', data: [20, 25, 22, 30, 35, 40, 45, 30, 25, 30, 35, 45], backgroundColor: '#86efac', borderRadius: 4, barThickness: 24 }
                    ]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: {display:false} }, scales: { y: {grid:{borderDash:[4,4], drawBorder:false}}, x:{grid:{display:false}} } }
            });

            const ctxDoughnut = document.getElementById('satisfactionChart').getContext('2d');
            charts.doughnut = new Chart(ctxDoughnut, {
                type: 'doughnut',
                data: {
                    labels: ['满意', '中规中矩', '不满意'],
                    datasets: [{ 
                        data: [65, 25, 10], 
                        backgroundColor: ['#15803d', '#86efac', '#e5e7eb'], 
                        borderWidth: 0, 
                        cutout: '75%', 
                        circumference: 260, 
                        rotation: 230, 
                        borderRadius: 20 
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: {display:false}, tooltip: {enabled:false} } }
            });
        }

        window.onload = renderApp;
    </script>
</body>
</html>